<!DOCTYPE html>

<head>
    <meta charset='utf-8' />
    <meta name="viewport" content="width=device-width,initial-scale=1">


    <script src="https://cesium.com/downloads/cesiumjs/releases/1.66/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.66/Build/Cesium/Widgets/widgets.css" rel="stylesheet">


    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">


    <script type="module" src="./Map/src/map_main.js"></script>




    <script>
        var map = {
            isReady: false,
        }
    </script>






    <style>
        @font-face {
            font-family: Acumin-bold;
            src: url("fonts/Acumin-BdPro.otf") format("opentype");
        }


        html,
        body,
        #cesiumContainer {
            height: 100%;
            width: 100%;
            margin: 0;
        }
    </style>

</head>

<body>
    <div id="cesiumContainer" class="fullSize"></div>

    <div id="toolbar"></div>

    <p id="TEXT"
        style="position: absolute; top: 60%; left: 0; font-family: Acumin-bold; font-size: 50px; font-weight: 500; color: red;">
        MY FONT!</p>

    <p id="PITCH" style="position: absolute; top: 0; left: 0; color: red; font-size: 40px; font-family: Roboto;">PITCH</p>
    <p id="DISTANCE" style="position: absolute; top: 20%; left: 0; color: red; font-size: 40px;">DISTANCE</p>
    <p id="HEIGHT" style="position: absolute; top: 30%; left: 0; color: red; font-size: 40px;">HEIGHT</p>

    <button style="position: absolute; top: 50%; left: 0" onclick="loadCities()">LABELS</button>
    <button style="position: absolute; top: 55%; left: 0" onclick="zoomIn()">ZOOM IN</button>
    <button style="position: absolute; top: 60%; left: 0" onclick="moveRight()">ROTATE</button>
    <button style="position: absolute; top: 65%; left: 0" onclick="testSphere()">testSphere</button>



    <script src="src/Math.js"></script>


    <script>
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




        Cesium.Ion.defaultAccessToken =
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzZDU1NWMyOC00YjFkLTQ5OTUtODg5Yy0zZDRlNGI1NTg3ZjciLCJpZCI6MTUxNTgsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1NjcyNDQ4NjR9.WDQmliwvLOArHiI9n4ET2TBELHRsGofW1unvSsbuyR8';
        var viewer = new Cesium.Viewer('cesiumContainer', {
            imageryProvider: new Cesium.MapboxImageryProvider({
                mapId: 'mapbox.satellite',
                accessToken: 'pk.eyJ1IjoiZGFuaWVsZXN1cHBvIiwiYSI6ImNqb2owbHp2YjAwODYzcW8xaWdhcGp1ancifQ.JvNWYw_cL6rV7ymuEbeTCw'
            }),
            terrainProvider: Cesium.createWorldTerrain(),
            animation: false,
            baseLayerPicker: false,
            fullscreenButton: false,
            geocoder: false,
            homeButton: false,
            infoBox: false,
            sceneModePicker: false,
            timeline: false,
            navigationHelpButton: false,
            useBrowserRecommendedResolution: false, /// change this to improve rendering speed on mobile
        });

        viewer.scene.globe.maximumScreenSpaceError = 4;


        /// INIT
        var center = new Cesium.Cartesian3(4410146, 966816, 4490121);
        // var radius = 6885;
        var radius = 50000;
        var boundingSphere = new Cesium.BoundingSphere(center, radius);
        viewer.camera.flyToBoundingSphere(boundingSphere, {
            offset: new Cesium.HeadingPitchRange(0, -1.47, 140000),
            duration: 0,
            complete: function () {
                console.log("DONE")
                map.isReady = true;
            }
        });




        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        function getPointFromCamera(xCanvas = null, yCanvas = null) {
            const canvas = viewer.scene.canvas;
            if (xCanvas === null || yCanvas === null) {
                xCanvas = canvas.clientWidth / 2;
                yCanvas = canvas.clientHeight / 2;
            }
            const ray = viewer.camera.getPickRay(new Cesium.Cartesian2(
                Math.round(xCanvas), Math.round(yCanvas)
            ));

            const point = viewer.scene.globe.pick(ray, viewer.scene);
            return point;
        }




        var camera = viewer.scene.camera;
        var cameraProperties = {
            minHeight: 0.4, // in Km
            maxHeight: 35, // in Km
            zoomRate: 7,

            get height() { // in Km
                var cartographic = new Cesium.Cartographic();
                var ellipsoid = viewer.scene.mapProjection.ellipsoid;
                ellipsoid.cartesianToCartographic(camera.positionWC, cartographic);
                return (cartographic.height * 0.001).toFixed(1);
            },

            get range() { // in meters
                let p = getPointFromCamera();
                if (p === undefined) {
                    p = new Cesium.Cartesian3(0, 0, 0);
                    // alert("Get camera range error!");
                }
                return Cesium.Cartesian3.distance(camera.positionWC, p);
            },
        };




        var pitch = 0;
        var height = 0;
        var cameraDistanceFromCenterPoint = 0;


        



        setInterval(function () {

            if (!map.isReady) return;

            pitch = Math.abs(Math.radToDeg(viewer.camera.pitch));

            document.getElementById("PITCH").innerHTML = "pitch " + viewer.camera.pitch;


            height = cameraProperties.height;
            document.getElementById("HEIGHT").innerHTML = "height " + height;



            document.getElementById("DISTANCE").innerHTML = "range " + cameraProperties.range;
        }, 250)

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



        function zoomIn() {

            boundingSphere.radius = 7000;
            viewer.camera.flyToBoundingSphere(boundingSphere, {
                // offset: offset,
                complete: function () {
                    console.log("FLYING COMPLETE")
                },
                duration: 8,
                easingFunction: Cesium.EasingFunction.QUADRACTIC_IN_OUT,

            });
        }












       
    </script>


    <!-- <script src="Map/src/cityLabels.js"></script> -->

</body>